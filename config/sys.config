[
    {lager, [
        {error_logger_hwm, 600},
        {log_root, "/var/log/hellgate"},
        {crash_log, "crash.log"},
        {handlers, [
            {lager_file_backend, [
                {file, "console.json"},
                {level, debug},
                {formatter, lager_logstash_formatter}
            ]}
        ]}
    ]},

    {scoper, [
        {storage, scoper_storage_lager}
    ]},

    {hellgate, [
        {ip, "::"},
        {port, 8022},
        {net_opts, [
            % Bump keepalive timeout up to a minute
            {timeout, 60000}
        ]},
        {service_urls, #{
            automaton           => <<"http://machinegun:8022/v1/automaton">>,
            eventsink           => <<"http://machinegun:8022/v1/event_sink">>,
            accounter           => <<"http://shumway:8022/accounter">>,
            party_management    => <<"http://hellgate:8022/v1/processing/partymgmt">>,
            customer_management => <<"http://hellgate:8022/v1/processing/customer_management">>,
            % TODO make more consistent
            recurrent_paytool   => <<"http://hellgate:8022/v1/processing/recpaytool">>
        }},
        {proxy_opts, #{
            transport_opts => #{
                connect_timeout => 1000,
                recv_timeout    => 40000
            }
        }}
    ]},

    {dmt_client, [
        {cache_update_interval, 5000}, % milliseconds
        {max_cache_size, #{
            elements => 20,
            memory => 52428800 % 50Mb
        }},
        {service_urls, #{
            'Repository' => <<"dominant:8022/v1/domain/repository">>,
            'RepositoryClient' => <<"dominant:8022/v1/domain/repository_client">>
        }}
    ]}
].
